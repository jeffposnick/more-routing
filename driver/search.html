<!--
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../driver.html">

<script>
(function(scope) {
  var MoreRouting = scope.MoreRouting = scope.MoreRouting || {};
  MoreRouting.SearchDriver = SearchDriver;

  /**
   * TODO(jeffposnick): Docs.
   */
  function SearchDriver() {
    MoreRouting.Driver.apply(this, arguments);
    this._bindEvents();
    this._read();
  }

  SearchDriver.prototype = Object.create(MoreRouting.Driver.prototype);

  SearchDriver.prototype.urlForParts = function urlForParts(parts) {
    return '?' + MoreRouting.Driver.prototype.urlForParts.call(this, parts);
  };

  // TODO(jeffposnick): Make this work with existing/additional search parameters
  SearchDriver.prototype.navigateToUrl = function navigateToUrl(url) {
    if (url.indexOf('?') === 0) {
      url = url.substring(1);
    }
    url = '?' + encodeURIComponent(url);

    window.history.pushState({}, '', url);
    this._read();
  };

  SearchDriver.prototype._bindEvents = function _bindEvents() {
    window.addEventListener('popstate', this._read.bind(this));
  };

  SearchDriver.prototype._read = function _read() {
    this.setCurrentPath(decodeURIComponent(window.location.search.substring(1) || '/'));
  };
})(window);
</script>
